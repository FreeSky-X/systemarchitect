# 2.3.4文件系统

## 1.文件与文件系统

文件 （File） 是具有符号名的。在逻辑上具有完整意义的一组相关信息项的集合，例如，个源程序一个目标程序编译程序一批待加工的数据和各种文档等都可以各自组成一个文件。文件是一种抽象机制，它隐藏了硬件和实现细节，提供了将信息保存在外存上而且便于以后读取的手段。使用户不必了解信息存储的方法。位置以及存储设备实际操作方式便可存取信息。一个文件包括文件体和文件说明文件体是文件真实的内容；  文件说明是操作系统为了管理文件所用到的信息，包括文件名。文件内部标识。文件类型。文件存储地址。文件长度 访问权限。建立时间和访问时间等。

文件系统是操作系统中实现文件统一管理的一组软件和相关数据的集合，是专门负责管理和存取文件信息的软件机构文件系统的功能包括按名存取。即用户可以 "按名存取" ，而不是4按地址存取"；统一的用户接口，在不同设备上提供同样的接口，方便用户操作和编程；  并发访问和控制，在多道程序系统中支持对文件的并发访问和控制； 安全性控制，在多用户系统中的不同用户对同一文件可有不同的访问权限；  优化性能，采用相关技术提高系统对文件的存储效率。检索和读/写性能；  差错恢复。能够验证文件的正确性。并具有一定的差错恢复能力。

## 2.文件的类型

1. 按文件的性质和用途分类可将文件分为系统文件。库文件和用户文件。
2. 按信息保存期限分类可将文件分为临时文件。档案文件和永久文件。
3. 按文件的保护方式分类可将文件分为只读文件。读/写文件可执行文件和不保护文件。
4. UNIX 系统将文件分为普通文件，目录文件和设备文件（特殊文件）。 

目前常用的文件系统类型有 EAT，VFATNTFSExt2 和 HPFS等。

 文件分类的目的是对不同文件进行管理，提高系统效率。提高用户界面友好性=当然，根据文件的存取方法和物理结构的不同，还可以将文件分为不同的类型。

## 3.文件的结构和组织

文件的结构是指文件的组织形式=从用户角度看到的文件组织形式称为文件的逻辑结构，文件系统的用户只要知道所需文件的文件名就可以存取文件中的信息，而无须知道这些文件究竟存放在什么地方。从实现的角度看 ，文件在文件存储器上的存放方式称为文件的物理结构。

### 1 ）文件的逻辑结构

文件的逻辑结构可分为两大类：是有结构的记录式文件，它是由一个以上的记录构成的文件； 二是无结构的流式文件，它是由一串顺序字符流构成的文件。

在记录式文件中，所有的记录通常都是描述一个实体集的，有着相同或不同数目的数据项，记录的长度可分为定长 （指文件中所有记录的长度相同）和不定长 （指文件中各记录的长度不相同）两类。

无结构的流式文件的文件体为字节流，不划分记录。无结构的流式文件通常采用顺序访问方式。并且每次读/写访问可以指定任意数据长度。其长度以字节为单位。对于流式文件的访问，是利用读/写指针指出下一个要访问的字符。可以把流式文件看作是记录式文件的一个特例。

### 2）文件的物理结构

文件的物理结构是指文件的内部组织形式。即文件在物理存储设备上的存放方法。由于文件的物理结构决定了文件在存储设备上的存放位置，所以文件的逻辑块号到物理块号的转换也是由文件的物理结构决定的。根据用户和系统管理上的需要，可采用多种方法来组织文件，下面介绍几种常见的文件物理结构。

1. 连续结构

  连续结构也称顺序结构，它将逻辑上连续的文件信息（如记录）依次存放在连续编号的物理块上。只要知道文件的起始物理块号和文件的长度，就可以很方便地进行文件的存取。

2. 链接结构

  链接结构也称串联结构，它是将逻辑上连续的文件信息（如记录）存放在不连续的物理块上，每个物理块设有一个指针指向下一个物理块。因此，只要知逍文件的第1个物理块号，就可以按链指针查找整个文件

3. 索引结构

  在采用索引结构时，将逻辑上连续的文件信息（如记录）存放在不连续的物理块中，系统为每个文件建立一张索引表。索引表记录了文件信息所在的逻辑块号对应的物理块号，并将索引表的起始地址放在与文件对应的文件目录项中。 

4. 多个物理块的索引表。

	索引表是在文件创建时由系统自动建立的，并与文件一起存放在同一文件卷上。根据一个文件大小的不同。其索引表占用物理块的个数不等， 一般占一个或几个物理块。多个物理块的索引表可以有两种组织方式：  链接文件和多重索引方式

## 4.文件存取的方法和存储空间的管理

### 1）文件的存取方法

文件的存取方法是指读/写文件存储器上的一个物理块的方法。通常有顺序存取和随机存取两种方法。顺序存取方法是指对文件中的信息按顺序依次进行读/写； 随机存取方法是指对文件中的信息可以按任意的次序随机地读/写。

### 2）文件存储空间的管理

要将文件保存到外部存储器 （简称外存或辅存）上。首先必须知道存储空间的使用情况，即哪些物理块是被 "占用"的。哪些是 "空闲" 的。特别是对大容量的磁盎存储空间被多用户共享时，用户执行程序经常要在磁盘上存储文件和删除文件，因此，文件系统必须对磁盘空间进行管理。外存空闲空间管理的数据结构通常称为磁盘分配表 （Disk Allocation Table）常用的空闲空间管理方法有空闲区表。位示图和空闲块链3种。

（1）空闲区表将外存空间上的一个连续的未分配区域称为 《空闲区" 。操作系统为磁盘外存上的所有空闲区建立一张空闲表，每个表项对应一个空闲区。空闲表中包含序号空闲区的第1块号空闲块的块数和状态等信息，如表2-1所示。它适用于连续文件结构。

=表2-1空闲区表序号笫1个空闲块号空闲块数状态1185可用2298可用310519可用未用

（2）位示图。这种方法是在外存上建立一第0字张位示图 （Bitmap） ， 记录文件存储器的使用第1字情况。每一位对应文件存储器上的一个物理块，第2字取值0和1分别表示空闲和占用。例如，某文件存储器上位示图的大小为n，物理块依次编第3字号为0，1，2，假如计算机系统中字长为32位。那么在位示图中的第0个字 （逻辑编号）第n-1字对应文件存储器上的0，1，2，31号物理块；2-7位示图例第1个字对应文件存储器上的32，33，34，63  号物理块。依此类推，如图2-7所示